<loader *ngIf="loading"></loader>

<div class="app-container" *ngIf="!loading">
  <div class="row">
    <div class="col-md-9 my-auto">
      <h2>Savings Calculator</h2>
    </div>
  </div>

  <div class="card card-custom">
    <div class="row">
      <div class="col-md-12">
        <div class="card-heading">Actual Consumption</div>
      </div>
      <div class="row">
        <div
          class="col-md-3 donut-legends"
          *ngFor="let donutLegend of donutLegends"
        >
          <div class="rectangle-position">
            <div
              class="rectangle"
              [style.backgroundColor]="donutLegend.color"
            ></div>
          </div>
          <div class="legend-text">{{ donutLegend.text }}</div>
        </div>
      </div>
      <div class="col-md-4 text-center">
        <app-donut-chart [total]="savingsResponseData.total_cost" [data]="savingsResponseData.values_cost"></app-donut-chart>
        <div class="donut-text">Cost (£)</div>
      </div>
      <div class="col-md-4 text-center">
        <app-donut-chart [total]="savingsResponseData.total_consumption" [data]="savingsResponseData.values_consumption"></app-donut-chart>
        <div class="donut-text">Consumption (kWh)</div>
      </div>
      <div class="col-md-4 text-center">
        <app-donut-chart [total]="savingsResponseData.total_c02" [data]="savingsResponseData.values_c02"></app-donut-chart>
        <div class="donut-text">Emission (kg-CO2)</div>
      </div>
    </div>
  </div>


  <div class="card card-custom">
    <div class="row">
      <div class="col-md-12">
        <div class="card-heading">Savings</div>
      </div>
      <div class="row">
        <div class="col-md-3">
          <p class="percent" [style.color]="donutLegends[0].color">Preparatory Hours</p>
          <div class="input-group mb-3">
            <input type="tel" maxlength="2" (keyup)="onUpdateSavings($event, 0)">
            <div class="input-group-append">
              <span class="input-group-text">%</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <p class="percent" [style.color]="donutLegends[1].color">Operational Hours</p>
          <div class="input-group mb-3">
            <input  type="tel" maxlength="2" (keyup)="onUpdateSavings($event, 1)">
            <div class="input-group-append">
              <span class="input-group-text">%</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <p class="percent" [style.color]="donutLegends[2].color">Non Operational Hours</p>
          <div class="input-group mb-3">
            <input  type="tel" maxlength="2" (keyup)="onUpdateSavings($event, 2)">
            <div class="input-group-append">
              <span class="input-group-text">%</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <p class="percent" [style.color]="donutLegends[3].color">Closed Hours</p>
          <div class="input-group mb-3">
            <input  type="tel" maxlength="2" (keyup)="onUpdateSavings($event, 3)">
            <div class="input-group-append">
              <span class="input-group-text">%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card card-custom">
    <div class="row">
      <div class="col-md-12">
        <div class="card-heading">Projected Consumption</div>
      </div>
      <div class="row">
        <div
          class="col-md-3 donut-legends"
          *ngFor="let donutLegend of donutLegends"
        >
          <div class="rectangle-position">
            <div
              class="rectangle"
              [style.backgroundColor]="donutLegend.color"
            ></div>
          </div>
          <div class="legend-text">{{ donutLegend.text }}</div>
        </div>
      </div>
      <div class="col-md-4 text-center">
        <app-donut-chart [total]="savingsProjectedData.total_cost" [data]="savingsProjectedData.values_cost"></app-donut-chart>
        <div class="donut-text">Cost (£)</div>
      </div>
      <div class="col-md-4 text-center">
        <app-donut-chart [total]="savingsProjectedData.total_consumption" [data]="savingsProjectedData.values_consumption"></app-donut-chart>
        <div class="donut-text">Consumption (kWh)</div>
      </div>
      <div class="col-md-4 text-center">
        <app-donut-chart [total]="savingsProjectedData.total_c02" [data]="savingsProjectedData.values_c02"></app-donut-chart>
        <div class="donut-text">Emission (kg-CO2)</div>
      </div>
    </div>
    <div>
      <div class="card-heading mt-5">In Other Words</div>
      <div class="row">
        <div class="col-md-4">
          <div class="alternate">
              <img width="50px" src="/assets/icons/icon-petrol.svg">
              <p class="my-auto">{{ totalSavings.petrol }} litres of Petrol saved</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="alternate">
              <img width="50px" src="/assets/icons/icon-car.svg">
              <p class="my-auto">{{ totalSavings.distance }} km of road trip gained</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="alternate">
              <img width="50px" src="/assets/icons/icon-smartphones.svg">
              <p class="my-auto">{{ totalSavings.smartphone }} smartphones charged</p>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <div class="alternate">
              <img width="50px" src="/assets/icons/icon-plant.svg">
              <p class="my-auto">{{ totalSavings.trees }} full-grown trees planted</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="alternate">
              <img width="50px" src="/assets/icons/icon-electricity.svg">
              <p class="my-auto">{{ totalSavings.electricity }} days of free electricity for your home</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="alternate">
              <img width="50px" src="/assets/icons/icon-trash.svg">
              <p class="my-auto">{{ totalSavings.trash }} days of no taking out the trash</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card card-custom">
  <loader *ngIf="loading"></loader>
  <div class="app-container" *ngIf="!loading">
    <div class="row">
      <div class="col-md-12">
        <div class="card-heading">Target Calculator</div>
      </div>
      <div class="row">
        <div class="col-md-4" *ngFor="let item of historicalConsumptionData; let i = index">
          <p class="percent" [style.color]="donutLegends[i].color"> Target</p>
          <div class="input-group mb-3">
            <input type="tel" (keyup)="calc(a.value, i)" [value]="item?.consumption_overview?.target" #a>
            <div class="input-group-append">
              <span class="input-group-text">kWh</span>
            </div>
           
          </div>
        </div>
      </div>
    </div>

      <div class="row">
      <!-- <owl-carousel-o [options]="customOptions"> -->  
      <div class="col-md-4"
        *ngFor="let item of historicalConsumptionData; let i = index"
      >
        <summary
          class="card card-custom"
          (click)="openMonthlyStats(item, i)"
          [ngClass]="{ 'card-border': selectedTileIndex === i }"
          *ngIf="!smallLoading[i]"
        >
          <div class="row">
            <div class="col-md-12 month">{{ item.month }} {{ item.year }}</div>
            
            <div class="col-md-6">
              <app-activity-gauge
                [data]="item.consumption_overview"
                [totalSize]="totalSize"
              ></app-activity-gauge>
            </div>
            <div class="col-md-6 my-auto">
              <div class="mb-3">
                <img class="trend-icon" [src]="setTrendIcon(item.target_trend)" />
                <span class="month">{{ item.energy.toLocaleString() }}</span> kWh
              </div>
              <div class="mb-3">
                <img class="trend-icon" [src]="setTrendIcon(item.target_trend)" />
                <span class="month">{{ item.co2_emission.toLocaleString() }}</span> kg CO2
              </div>
              <span
                class="month"
                [style.color]="
                  calculateTarget(
                    item.consumption_overview.target,
                    item.consumption_overview.present,
                    item.month
                  ).color
                "
              >
                {{
                  calculateTarget(
                    item.consumption_overview.target,
                    item.consumption_overview.present,
                    item.month
                  ).value
                }}%
              </span>
              <span
                >{{
                  calculateTarget(
                    item.consumption_overview.target,
                    item.consumption_overview.present,
                    item.month
                  ).text
                }}
              </span>
            </div>
          </div>
        </summary>
      </div>
    <!-- </owl-carousel-o> -->
  
    <!-- <div *ngIf="showMonthlyStats">
      <loader *ngIf="!dayAnalysisData && oakScore < 0"></loader>
      <div class="card card-custom mt-4" *ngIf="dayAnalysisData && oakScore >= 0">
        <div class="close">
        <button class="close-btn" (click)="closeMonthlyStats()">
          <img src="/assets/icons/cancel.png" />
        </button>
        </div>
        <div class="row">
          <div class="col-md-3">
            <div class="oakscore-card">
              <div class="oakscore">
                <div class="oak-score-badge">
                  <img
                    class="img-res"
                    src="/assets/icons/icon-oakscore-green.svg"
                  />
                </div>
                <div class="oak-score">
                  <button class="button "
                  mat-button
                  matTooltip="what is oak score"
                  matTooltipPosition="left"
                  aria-label="Button that displays a tooltip when focused or hovered over"
                >
                ⓘ
                </button>
                  <div class="oak-score-label">OAK Score</div>
                  <div class="oak-score-text">
                    {{ oakScore }}
                  </div>
                </div>
              </div>
            </div>
          </div>
  
          <div class="col-md-9 my-auto">
            <div class="insights-column" *ngFor="let card of cards">
              <app-insight-item-tile [data]="card"></app-insight-item-tile>
            </div>
          </div>
        </div>
  
        <div class="row mt-5">
          <div class="card-heading ml-5">Day by day Analysis</div>
          <span class="widget-subtitle ml-5">Comparison of daily consumption</span>
          <app-line-column [data]="dayAnalysisData"></app-line-column>
        </div>
      </div>
    </div> -->
    </div>
  </div>
</div>

